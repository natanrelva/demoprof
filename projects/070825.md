## ğŸ§© 1. Estrutura Geral (visÃ£o simplificada)

O sistema pode ser visto como 3 grandes blocos independentes:

```
[CANAIS] â†’ [AGENTE IA + GRAFO] â†’ [NUÌCLEO DE COMÃ‰RCIO]
```

* **\[CANAIS]** = WhatsApp, Telegram, etc. SÃ³ enviam/recebem mensagens.
* **\[AGENTE IA + GRAFO]** = Interpreta a mensagem e decide o que fazer.
* **\[NUÌCLEO DE COMÃ‰RCIO]** = Cria pedido, cobra, responde, registra.

---

## ğŸ›ï¸ 2. Blocos Funcionais Resumidos

| Nome do Bloco          | FunÃ§Ã£o Principal                 | SimplificaÃ§Ã£o                                                   |
| ---------------------- | -------------------------------- | --------------------------------------------------------------- |
| **Canal**              | Envia/recebe mensagem do usuÃ¡rio | WhatsApp, Telegram, etc. SÃ£o sÃ³ ponte de entrada/saÃ­da.         |
| **Agente IA**          | Entende intenÃ§Ã£o da mensagem     | Usa regras ou IA para saber o que o usuÃ¡rio quer.               |
| **Grafo de NavegaÃ§Ã£o** | Define os caminhos da conversa   | Uma sequÃªncia de perguntas e respostas como um fluxograma.      |
| **Executor de AÃ§Ã£o**   | Faz o que foi pedido             | Ex: criar pedido, mostrar produto, iniciar pagamento.           |
| **Pedido**             | Representa a compra em si        | ContÃ©m produto, valor, canal e status (criado, pago, etc.)      |
| **Pagamento**          | Lida com o pagamento             | Gera link, espera confirmaÃ§Ã£o e muda status.                    |
| **Antifraude**         | Detecta comportamento suspeito   | Verifica riscos antes de confirmar aÃ§Ãµes sensÃ­veis.             |
| **Adaptadores**        | Conectam partes externas         | Transforma pedidos da lÃ³gica interna em chamadas reais de APIs. |
| **Logger / Estado**    | Guarda histÃ³rico do usuÃ¡rio      | Para que o fluxo continue de onde parou.                        |

---

## ğŸ› ï¸ 3. Funcionalidades mÃ­nimas e claras

Cada funcionalidade abaixo pode ser isolada, documentada e implementada sem depender de todo o sistema estar pronto:

| ID    | Nome                | ExplicaÃ§Ã£o simplificada                                |
| ----- | ------------------- | ------------------------------------------------------ |
| `M01` | Entender mensagem   | Detectar se o usuÃ¡rio quer comprar, pagar, cancelar... |
| `M02` | Escolher produto    | Mostrar opÃ§Ãµes e deixar o usuÃ¡rio escolher.            |
| `M03` | Criar pedido        | Gerar um pedido com produto e canal.                   |
| `M04` | Iniciar pagamento   | Gerar link e enviar para o usuÃ¡rio pagar.              |
| `M05` | Confirmar pagamento | Marcar como â€œpagoâ€ e avisar o usuÃ¡rio.                 |
| `M06` | Ver histÃ³rico       | Mostrar pedidos anteriores do mesmo usuÃ¡rio.           |
| `M07` | Validar fraude      | Bloquear aÃ§Ãµes suspeitas.                              |
| `M08` | Voltar onde parou   | Continuar a conversa se o usuÃ¡rio cair e voltar.       |
| `M09` | Testar por canal    | Simular fluxo para WhatsApp e Telegram.                |

---

## ğŸ”„ 4. Fluxo de Compra (via canal)

1. UsuÃ¡rio manda mensagem no canal (WhatsApp/Telegram)
2. Agente entende a intenÃ§Ã£o (ex: â€œquero comprarâ€)
3. O grafo responde perguntando o produto
4. UsuÃ¡rio escolhe
5. Sistema cria pedido
6. Gera link de pagamento especÃ­fico do canal
7. Espera confirmaÃ§Ã£o do pagamento
8. Marca como pago e envia mensagem de sucesso

---

## ğŸ”Œ 5. Adapters e Interfaces (camada de conexÃ£o)

| Nome               | SimplificaÃ§Ã£o                                     |
| ------------------ | ------------------------------------------------- |
| Canal Adapter      | Recebe texto e envia texto. Nada mais.            |
| Pagamento Adapter  | Recebe valor e retorna link. Espera webhook.      |
| Grafo Adapter      | Recebe entrada, retorna prÃ³xima pergunta ou aÃ§Ã£o. |
| Antifraude Adapter | Recebe dados, responde â€œpode ou nÃ£o podeâ€.        |

---

## ğŸ” 6. SeguranÃ§a / Antifraude

* Toda aÃ§Ã£o pode ser avaliada antes de ser executada.
* Exemplo: bloqueia se houver muitas compras em pouco tempo.
* Resultados simples: **"pode seguir" ou "bloquear"**.

---

## ğŸ§ª 7. Testes (por tipo)

| Tipo           | O que testa                                           |
| -------------- | ----------------------------------------------------- |
| **UnitÃ¡rio**   | Cada parte sozinha: grafo, parser, adaptador de canal |
| **IntegraÃ§Ã£o** | ConexÃµes reais entre canal â†’ grafo â†’ backend          |
| **Funcional**  | Um fluxo completo de compra simulada                  |
| **SeguranÃ§a**  | Testa se o antifraude bloqueia como esperado          |

---

## ğŸ“¦ 8. MVP Absolutamente MÃ­nimo

Para validar tudo:

* Canal: WhatsApp (mockado ou real via Cloud API)
* Agente: IA simples com 2-3 intenÃ§Ãµes
* Grafo: fluxo com 3 nÃ³s (boas-vindas â†’ escolha â†’ pagamento)
* Backend: cria pedido em memÃ³ria
* Pagamento: gera link simulado
* ConfirmaÃ§Ã£o: mensagem de sucesso pÃ³s-pagamento
* Antifraude: regra simples (1 pedido por minuto)

---

## ğŸ—‚ï¸ 9. OrganizaÃ§Ã£o por Pastas (projeto limpo)

```
/agents/         â†’ agentes IA por canal
/adapters/       â†’ integraÃ§Ãµes externas (canal, pagamento)
/core/           â†’ domÃ­nio: pedido, pagamento, antifraude
/graph/          â†’ fluxos e transiÃ§Ãµes
/interfaces/     â†’ portas (Ports)
/usecases/       â†’ lÃ³gica de aplicaÃ§Ã£o (Interactors)
/tests/          â†’ testes unitÃ¡rios e e2e
```
